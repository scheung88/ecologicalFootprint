---
title: "Wrangling"
author: "Shirley Cheung, Tuan Nguyen"
date: "April 25, 2018"
output: html_document
---

```{r setup, include = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, warning = FALSE, message = FALSE, include = FALSE}
library(readr)
library(rvest)
library(ggmap)
library(ggplot2)
library(ggthemes)
library(maps)
library(leaflet)
library(dplyr)
library(tidyr)
library(stringr)
library(fitdistrplus)
library(lme4)

ecoDataReg <- read_csv("ecoDataReg.csv")
ecoData <- read_csv("ecoData.csv")
```
## Introduction 
It currently takes 1.5 Earths to feed 7 billion people. With the exponential growth of global population, we are consuming natural resources at an alarming rate. To measure mankind's existential pressure on the environment, Mathis Wackernagel and William Rees at the University of British Columbia came up with two quantities: ecological footprint and biocapacity. The former measures the ecological assets that are required to sustain a given population. The latter tracks the productivity of the same ecological assets, accounting for waste accumulation, pollution and so on.

A country is running an ecological deficit when its footprint exceeds biocapacity, and running an ecological reserve otherwise. In the long run, this means the country's ecosystems are no longer sustainable for its demands, and are heading for extinction. Of course, extinction is rarely the case thanks to the free flow of trade. This project aims to predict ecological deficit / reserve of a nation in 2016 using the following country-specific characteristics:

* Population in 2016
* GDP per capita in 2016
* The continent that the country is on 
* The total food production in 2013
* The greenhouse level in 2012
* The human development index in 2015

The data on net ecological footprint, population, continent and GDP per capita was collected by Global Footprint Network and downloaded from [Kaggle](https://www.kaggle.com/footprintnetwork/ecological-footprint). This is our main source of predictors and response variables. For this data we replaced continent (e.g Middle East/Central Asia) by its abbreviation (e.g AS). Originally in character format, GDP per capita was converted into number through very simple string manipulation (dropping the *$* sign). The next predictor on the list, food production data, was downloaded from [Kaggle](https://www.kaggle.com/unitednations/global-food-agriculture-statistics/data), by courtesy of the [United Nation](http://data.un.org/Explorer.aspx). This dataset spans between 1990 and 2013. We took the latest data (2013) and created a new variable by summing up food production across different categories. The Greenhouse Gas Emissions data by Country is collected by [World Resources Institue](http://www.wri.org/resources/data-sets/cait-country-greenhouse-gas-emissions-data). Similar to the food production data, we picked the most recent year (2012) of CO2 emission for each country. Last but not least is the Human Development Index data in 2015, by courtesy of [UNDP](http://hdr.undp.org/en/data). 

To merge these 5 different predictors into 1 dataset, we performed inner-joins on the "Country" field. The majority of our wrangling efforts was spent on anti-joining the master dataset and the smaller one containing the predictor to reconcile different names of the same country (e.g USA vs United States of America).  

(Not sure where to include this) Since we are interested in predicting whether a country would run an ecological deficit or reserve, we decided to introduce another response variable: Binomial net ecological footprint. Any country with a *negative* net ecological footprint will receive a 0 for this new column, and 1 otherwise. 

Our final version of the data looks like this: 

```{r, echo=FALSE}
glimpse(ecoDataReg)
```

Before trying our hand at Mixed Effect Modeling? [Do we need to say why we are exploring Mixed Effect Modeling?], let's see the world outlook on ecological foot print. We produced the following choropleth maps by joining our final dataset for regression with a dataset of longtitude and latitude coordinates of all countries. 

```{r, echo=FALSE}

ggplot() + 
  geom_polygon(data = ecoData, 
               aes(x = long, y = lat, fill = as.factor(binomFootprint), group = group),
               col = "white") +
  xlab("Long") +
  ylab("Lat") +
  theme_minimal()
```

The first map shows that America, North Africa, Central? Europe a good part of Asia are running a deficit in their ecosystems. It makes sense for Asia, which contains many developing countries, to be stretching out its resources in booming times. However, the argument does not really apply to a fairly established first world country like U.S.A. In our opinion, this is largely due to the entrenched environmental toll of fossil fuels industries, which render the ecosystem unsuitable for renewal. 

```{r, echo=FALSE}
ggplot() + 
  geom_polygon(data = ecoData, 
               aes(x = long, y = lat, fill = transFootprint, group = group),
               col = "white") +
  xlab("Long") +
  ylab("Lat") +
  theme_minimal()
```

The second map shows the severity of deficit / reserve, rather than whether it is a defit or reserve in each country. There isn't a clear trend from the color gradient, but again we can tell that the States is suffering from a bad case of ecological deficit.

```{r, echo=FALSE}
ggplot(aes(x = transFootprint), data = ecoDataReg) + 
  geom_density() + 
  facet_wrap(~ continent)
```

Lastly, we present a distribution of net ecological footprints, broken down by continent. The footprints of most continents are normally distributed, with a few outliers. Most distributions center around roughly the same point (roughly 2.5). This graph provides evidence that there is not much distinction in net ecological footprints between different continents. We will later on confirm this observation through Mixed Effects Regression, which...

```{r}

```

Not sure if we need to talk a bit about distribution... your call Shirley

## Fitting Distribution
```{r, eval=FALSE}
# Determining distribution of Y
# Our Y-variable = net biocapcity of each country
hist(log(ecoData$netFootprint))
descdist(log(ecoData$netFootprint + 15), discrete = FALSE)

# Looks like a beta distribution 
# Solve for parameters, alpha and beta, from the summary mu and sd
# Recall for the beta distribution
## mu = alpha / (alpha + beta)
## var = alpha*beta / [(alpha + beta)^2 (alpha + beta + 1)]
parameters <- function(mu, var) {
  alpha <- ((1 - mu)/var - 1/mu) * mu^2
  beta <- alpha * (1/mu - 1)
  return(params = list(alpha = alpha, beta = beta))
}
parameters(0.7020745, 11.77134^2)

# Problem: we have negative values for alpha, beta
# Also have negative values for our y's. Support of beta distribution
# should only be in (0,1). Need to do a transformation? Or not beta
# distribution. 

# fitBeta <- fitdist(countries$netBiocap, "beta")
# plot(fitBeta)

# Y = total biocapcity
hist(ecoData$totalBiocap)
descdist(ecoData$totalBiocap, discrete = FALSE)

# Y = total footprint
hist(ecoData$totalFootprint)
descdist(ecoData$totalFootprint, discrete = FALSE)
```

